!function(e,t){"function"==typeof define?define(t):this[e]=t()}("LbWidget",function(){function e(e){return e.id&&""!=e.id?(s=this,this._default={container:".lbwidget"},this._options=t(this._default,e),this._options.wid=this._options.id+"-"+(Math.random()+"").substr(2,6),this.$container=r.querySelector(this._options.container),this._init(),void(this.$item=this.$container.querySelector("div"))):!1}function t(e,t){for(var o in t)e[o]=t[o];return e}function o(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.replace("&amp;","&"),i=o.substr(1).match(t);return null!=i?unescape(i[2]):null}function i(e){for(var t=e.offsetTop,o=e.offsetParent;null!==o;)t+=o.offsetTop,o=o.offsetParent;return t}function n(){if(a.closetocart){var e=a.closetocart.split("_"),t="lb-widget-cart-"+e[1];r.getElementById(t)&&r.getElementById(t).remove();var o=r.createElement("div");o.id=t,o.style.display="none",o.innerHTML='<iframe src="'+s._options.url+"/widget/autocartsub?wid="+s._options.wid+"&shop_id="+e[1]+"&guest_id="+encodeURIComponent(e[0])+'" style="display:none"></iframe>',r.body.appendChild(o)}}function l(){a._lbin&&Array.prototype.forEach.call(a._lbin,function(t,o){"init"==t[0]&&1!=t[1].load&&(t[1].load=1,t[1].url=a.lbu,new e(t[1]),console.log(t))})}var s,r=document,a=window;return e.prototype._init=function(){var e=this;if(!a.lb_is_init){a.lb_is_init=1,"video"!=e._options.tpl&&localStorage.getItem("livebuy_cart_num-"+this._options.id)>0&&(a.closetocart=localStorage.getItem("livebuy_guest_id")+"_"+this._options.id,n()),a.addEventListener?a.addEventListener("message",function(t){e._message(t)}):a.attachEvent&&a.attachEvent("onmessage",function(t){e._message(t)});var t=r.createElement("style");t.type="text/css",t.innerHTML=".livebuy-widget{width:100%}.lb-widget-show{touch-action: none;overflow: hidden;width:100%;height:100%;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;user-select:none;}.lb-widget-show *{touch-action: none;}",r.getElementsByTagName("head")[0].appendChild(t);var i=o("livebuy");if(i){var l=i.split("-");"auto"==l[0]?e._message({data:{wid:e._options.wid,type:"video",val:e._options.url+"/auto/"+l[1]}}):e._message({data:{wid:e._options.wid,type:"video",val:e._options.url+"/videos/"+l[0]+"?t="+(l.length>1?l[1]:0)}})}}if("full"==e._options.tpl&&(a.lb_full=e._options.wid,a.addEventListener("scroll",function(t){e._scroll(t,e._options.wid)})),"video"==e._options.tpl){var s=e.$container.offsetWidth||e.$container.clientWidth;s=s>420||!s?420:s,e.$container.innerHTML='<div id="lb-widget-'+e._options.wid+'" style="width: 100%; height: '+1.7*s+'px;display: inline-block;overflow: hidden;"><div style="width: 100%;max-width:420px;height: 100%;border:1px solid #f5f5f5;position: relative;border-radius: 0.5rem;overflow: hidden;"><iframe src="'+e._options.url+"/videos/"+e._options.id+"?wid="+e._options.wid+"&single=1&source=widget&userid="+(e._options.userid?e._options.userid:"")+"&t="+(e._options.t?e._options.t:"")+"&shareid="+(e._options.shareid?e._options.shareid:"")+"&surl="+encodeURIComponent(r.location.href)+'" allow="autoplay" style="box-sizing: border-box; border: 0px none; pointer-events: auto; outline: none; width: 100%;height: 100%;"></iframe></div></div>'}else if("live"==e._options.tpl||"livew"==e._options.tpl){if("livew"==e._options.tpl){var d=e.$container.parentNode.offsetHeight||e.$container.parentNode.clientHeight;e.$container.innerHTML='<div id="lb-widget-'+e._options.wid+'" style="width: 100%; height: '+d+'px;display: inline-block;overflow: hidden;"><div style="width: 100%;height: 100%;position: relative;overflow: hidden;"><iframe src="'+e._options.url+"/player/"+e._options.id+"?wid="+e._options.wid+'&ty=live" allow="autoplay" style="box-sizing: border-box; border: 0px none; pointer-events: auto; outline: none; width: 100%;height: '+d+'px;"></iframe></div></div>'}}else e.$container.innerHTML='<div id="lb-widget-'+e._options.wid+'" style="width: 100%; height: 320px; box-sizing: border-box;background-color: transparent;background-size: auto 80px;background-repeat: no-repeat;background-position: center;background-image:url('+e._options.url+'/image/background/livebuy-loading.webp)"><iframe src="'+e._options.url+"/widget/"+e._options.id+"?wid="+e._options.wid+"&tpl="+(e._options.tpl?e._options.tpl:"")+'" style="box-sizing: border-box; border: 0px; width: 100%; height: 100%;" onload="document.getElementById(\'lb-widget-'+e._options.wid+"').style.background='unset';\"></iframe></div>";"full"==e._options.tpl&&setTimeout(function(){e._scroll("",e._options.wid)},2500),e._options.success&&"function"==typeof e._options.success&&e._options.success(e)},e.prototype._scroll=function(e,t){var o=a.pageYOffset||r.documentElement.scrollTop||r.body.scrollTop,n=r.documentElement.clientHeight||r.body.clientHeight,l=r.getElementById("lb-widget-"+t),s=i(l),d=l.clientHeight;o+n>=s&&s+d>=o&&o>s+d-n&&l.querySelector("iframe").contentWindow.postMessage({type:"page"},"*"),o>s-n&&s+d>=o&&l.querySelector("iframe").contentWindow.postMessage({type:"preview",val:o-s},"*")},e.prototype._message=function(e){var t=this,o=e.data,l=r.getElementById("lb-widget-container-"+o.wid);if("height"==o.type){var s=r.getElementById("lb-widget-"+o.wid);s.style.height=o.val+"px",0==o.val&&(s.style.display="none")}else if("video"==o.type){l?l.remove():"";var d=document.createElement("div"),p=r.querySelector("body");d.innerHTML='<div id="lb-widget-container-'+o.wid+'" style="width: 100%; height: calc(100% + 1px); background: rgba(0, 0, 0, 0.9);background-image: url(\'https://livebuy.tv/image/background/livebuy-loading.webp\');background-position: center;background-repeat: no-repeat;background-size: auto 80px; position: fixed; top: -1px; left: 0px;right:0;bottom:0; display: flex; justify-content: center; align-items: center; z-index: 9999999999;overflow: hidden;"><div style="width: 100%;height: 100%;position: relative;"><iframe src="'+o.val+(-1==o.val.indexOf("?")?"?":"&")+"wid="+o.wid+"&source=widget&userid="+(t._options.userid?t._options.userid:"")+"&shareid="+(t._options.shareid?t._options.shareid:"")+"&surl="+encodeURIComponent(r.location.href)+'" allow="autoplay" style="box-sizing: border-box; border: 0px none; pointer-events: auto; outline: none; width: 100%;height: 100%;" onload="document.getElementById(\'lb-widget-container-'+o.wid+"').style.backgroundImage='unset';\"></iframe></div></div>",p.appendChild(d),p.style.overflow="hidden",p.classList.add("lb-widget-show")}else if("close"==o.type){var p=r.querySelector("body");l?l.remove():"",p.style.overflow="unset",p.classList.remove("lb-widget-show"),("top"==o.val||"refreshtop"==o.val)&&(r.body.scrollTop=0,r.documentElement.scrollTop=0,a.scrollTo(0,0)),("refresh"==o.val||"refreshtop"==o.val)&&setTimeout(function(){r.location.reload()},100),a.closetocart&&n()}else if("min"==o.type)l.style.width="180px",l.style.height="320px",l.style.top="unset",l.style.left="unset",l.style.bottom="20px",l.style.borderRadius="15px",r.querySelector("body").style.overflow="unset";else if("max"==o.type)l.style.width="100%",l.style.height="100%",l.style.top=0,l.style.left=0,l.style.bottom=0,l.style.borderRadius=0,r.querySelector("body").style.overflow="hidden";else if("link"==o.type)document.location.href=o.val;else if("to_cart"==o.type){var c=a.closetocart?"livebuy_cart_num-"+a.closetocart.split("_")[1]:"";if(a.closetocart&&localStorage.getItem(c)>0){var u=o.val;Array.prototype.forEach.call(u,function(e,t){livebuy_add_to_cart(e.id,e.spec,e.num)}),localStorage.setItem(c,0)}else o.val.buy_no?livebuy_add_to_cart(o.val.specification_no,o.val.amount,o.val.buy_no):livebuy_add_to_cart(o.val.specification_no,o.val.amount)}else if("more"==o.type)t._options.more_url?document.location.href=t._options.more_url:a.lb_full?a.scrollTo(0,i(r.getElementById("lb-widget-"+a.lb_full))):a.open(o.val);else if("lbclose"==o.type)lbvideoClose();else if("liveurl"==o.type)a.lbliveurl=o.val;else if("variable"==o.type)a[o.val.k]=o.val.v;else if("local"==o.type){var v=o.val.v;if(-1!=o.val.k.indexOf("livebuy_cart_num")){var h=parseInt(localStorage.getItem(o.val.k));h=!isNaN(h)&&h>0?h:0,v=0==o.val.v?0:h+o.val.v}localStorage.setItem(o.val.k,v)}else if("changewh"==o.type){var y=r.body.clientWidth,f=r.getElementById(o.val.id),g=f.querySelector("iframe");if(g.style.width=o.val.w+"px",g.style.height=o.val.h+"px",900>y){if(o.val.w>o.val.h){var b=y/2/o.val.w;f.style.transform="scale("+b+")"}else var b=y/4/o.val.w;f.style.right=10-(1-b)/2*o.val.w+"px",f.style.bottom=10-(1-b)/2*o.val.h+"px"}}},l(),a.LbWidgetReload=l,e});